<div fxLayout="row" fxLayoutAlign="center center" class="configuration--section" [ngClass]="[isOnboarding ? 'configuration--onboarding-section' : '', !isOnboarding ? 'configuration--post-onboarding-section': '']">
  <app-loader [ngClass]="{'loader-main': !isOnboarding}" [phase]="'pre_onboarding'" *ngIf="isLoading"></app-loader>
  <div *ngIf="!isLoading" class="configuration--contents">
    <app-configuration-step-header-section [showSyncButton]="isOnboarding" [phase]="isOnboarding ? ProgressPhase.ONBOARDING : ProgressPhase.POST_ONBOARDING"></app-configuration-step-header-section>
    <form [formGroup]="exportSettingsForm">
      <app-configuration-select-field
        [form]="exportSettingsForm"
        [options]="expenseStateOptions"
        [isFieldMandatory]="true"
        [mandatoryErrorListName]="'expense state'"
        [iconPath]="'assets/images/svgs/actions/question-mark.svg'"
        [label]="'At which state should the expenses be ready to export from Fyle?'"
        [subLabel]="'You could choose to export expenses when they have been approved and are awaiting payment clearance, OR simply when they have been paid out.'"
        [placeholder]="'Select expense state'"
        [formControllerName]="'expenseState'"
        >
      </app-configuration-select-field>

      <app-configuration-toggle-field
        [form]="exportSettingsForm"
        [label]="'Export Reimbursable Expenses'"
        [subLabel]="'Enable this to export the reimbursable expenses from Fyle. If not enabled, any <span class=bold>out-of-pocket</span> expenses will not be exported to Xero.'"
        [formControllerName]="'reimbursableExpense'"
      >
      </app-configuration-toggle-field>

      <div *ngIf="exportSettingsForm.value.reimbursableExpense">
        <app-configuration-select-field
          [form]="exportSettingsForm"
          [options]="reimbursableExportTypes"
          [isFieldMandatory]="true"
          [mandatoryErrorListName]="'expense export type'"
          [iconPath]="'assets/images/svgs/general/expense.svg'"
          [label]="'How should the expense be exported?'"
          [subLabel]="'Choose the type of transaction in Xero to export your Fyle expenses.'"
          [placeholder]="'Select expense export type'"
          [formControllerName]="'reimbursableExportType'"
          [phase]="isOnboarding ? ProgressPhase.ONBOARDING : ProgressPhase.POST_ONBOARDING"
          >
        </app-configuration-select-field>

        <div *ngIf="showBankAccountField()">
          <app-configuration-select-field
            [form]="exportSettingsForm"
            [xeroAttributes]="bankAccounts"
            [isFieldMandatory]="true"
            [mandatoryErrorListName]="'bank account'"
            [label]="'To which Bank Account should the ' + getExportType(exportSettingsForm.value.reimbursableExportType) + ' be posted to?'"
            [subLabel]="'All the offset entry in the Journal will be posted to the selected Bank account'"
            [placeholder]="'Select Bank Account'"
            [formControllerName]="'bankAccount'"
            >
          </app-configuration-select-field>
        </div>

        <div *ngIf="exportSettingsForm.value.reimbursableExportType">
          <app-configuration-select-field
            [form]="exportSettingsForm"
            [options]="reimbursableExpenseGroupingDateOptions"
            [isFieldMandatory]="true"
            [mandatoryErrorListName]="'date'"
            [iconPath]="'assets/images/svgs/general/calendar.svg'"
            [label]="'Set the ' + getExportType(exportSettingsForm.value.reimbursableExportType) + ' date as'"
            [subLabel]="'The selected date will reflect in expenses exported to Xero'"
            [placeholder]="'Select the date of the ' + getExportType(exportSettingsForm.value.reimbursableExportType)"
            [formControllerName]="'reimbursableExportDate'"
            >
          </app-configuration-select-field>
        </div>
      </div>

      <app-configuration-toggle-field
        [form]="exportSettingsForm"
        [label]="'Export Corporate Card Expenses'"
        [subLabel]="'Enable this to export the corporate card expenses from Fyle. If not enabled, any expenses <span class=bold>Paid by Corporate Card</span> will not be exported to Xero.'"
        [formControllerName]="'creditCardExpense'"
      >
      </app-configuration-toggle-field>

      <div *ngIf="exportSettingsForm.value.creditCardExpense">
        <app-configuration-select-field
          [form]="exportSettingsForm"
          [options]="creditCardExportTypes"
          [isFieldMandatory]="true"
          [mandatoryErrorListName]="'expense export type'"
          [iconPath]="'assets/images/svgs/general/expense.svg'"
          [label]="'How should the expense be exported?'"
          [subLabel]="'Choose the type of transaction in Xero to export your corporate card expense from Fyle.'"
          [placeholder]="'Select expense export type'"
          [formControllerName]="'creditCardExportType'"
          [phase]="isOnboarding ? ProgressPhase.ONBOARDING : ProgressPhase.POST_ONBOARDING"
          >
        </app-configuration-select-field>

        <div *ngIf="exportSettingsForm.value.creditCardExportType">
          <app-configuration-select-field
            [form]="exportSettingsForm"
            [options]="cccExpenseGroupingDateOptions"
            [isFieldMandatory]="true"
            [mandatoryErrorListName]="'date'"
            [iconPath]="'assets/images/svgs/general/calendar.svg'"
            [label]="'Set the ' + getExportType(exportSettingsForm.value.creditCardExportType) + ' date as'"
            [subLabel]="'The selected date will reflect in the corporate card expenses exported to Xero.'"
            [placeholder]="'Select the date of the ' + getExportType(exportSettingsForm.value.creditCardExportType)"
            [formControllerName]="'creditCardExportDate'"
            >
          </app-configuration-select-field>
        </div>
      </div>

      <app-configuration-step-footer-section [ctaText]="!saveInProgress ? (isOnboarding ? ConfigurationCtaText.SAVE_AND_CONTINUE : ConfigurationCtaText.SAVE) : ConfigurationCtaText.SAVING" [showBackButton]="isOnboarding" [isButtonDisabled]="!exportSettingsForm.valid || saveInProgress" (navigateToPreviousStep)="navigateToPreviousStep()" (save)="save()"></app-configuration-step-footer-section>
    </form>
  </div>
</div>
<app-onboarding-footer *ngIf="isOnboarding && !isLoading"></app-onboarding-footer>
